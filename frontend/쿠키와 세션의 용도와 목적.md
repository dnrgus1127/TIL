
HTTP 프로토콜을 통한 웹 통신은 기본적으로 stateless하기 때문에 매 HTTP요청마다 서버는 클라이언트에 대한 정보를 알 수 없다.

이를 해결하기 위해 웹에서는 쿠키와 세션을 사용한다.

# 쿠키

HTTP는 상태를 저장하기 않기 때문에 서버가 해당 HTTP요청을 보낸 클라이언트에게 개인화된 서비스(장바구니, 언어 설정 등)을 유지하는데 어려움이 있다.

그래서 브라우저에서 상태 정보를 저장하는 방식인 쿠키를 사용하게 되었다.

쿠키는 목적대로 클라이언트(브라우저)측에 저장되는 key-value 형식 데이터 파일이다.

## 쿠키의 동작 방식

우선 쿠키의 동작 방식을 살펴보고 쿠키의 특징들을 알아보자.

1. 서버가 쿠키를 생성해서 HTTP응답과 함께 쿠키를 전송한다.
2. 클라이언트는 서버에서 받은 쿠키를 저장하고, 브라우저는 해당 쿠키의 만료 이전까지 쿠키를 유지한다.
3. 다시 클라이언트가 서버에 요청을 할 때 쿠키를 HTTP 헤더에 담아서 전송한다.
4. 서버는 HTTP 요청에 포함된 쿠키를 읽어서 필요한 데이터를 읽고 업데이트하여 클라이언트에게 전송한다.

### 쿠키의 특징

우선 동작과정에서 알 수 있는 쿠키의 목적과 특징은 다음과 같다.

- 목적 : 클라이언트에 상태를 유지해서 임시 데이터(장바구니 등)나 사용자에 대한 정보를 기억하기 위해 사용한다.

- 쿠키는 주로 서버에서 생성되어 클라이언트에 저장된다.
- 쿠키는 브라우저가 관리하며, 쿠키가 만료되기 전까지 쿠키를 유지한다.
- 쿠키는 사용자가 요청하지 않아도 브라우저가 HTTP 요청에 실어서 서버로 전송한다.

이외에도 쿠키는 이런 특징을 가진다.

- 쿠키는 다른 도메인이 대신 생성할 수 없다.
- 쿠키는 브라우저별로 저장되기 때문에 브라우저 각각의 쿠키를 가진다.

하지만 보안적인 문제 때문에 쿠키를 사용하지 못하는 경우도 있다.

쿠키는 쉽게 읽고 조작할 수 있기 때문에 쿠키에 사용자의 로그인 정보나 개인정보를 저장하면 쉽게 유출될 수 있고, 사용자가 임의로 조작할 수 있기 때문에 서버가 사용자별 권한 정보 등을 저장하기에는 부적절하다.

이런 문제를 해결하기 위해 쿠키와 세션을 사용한다.

---

# 세션

세션도 쿠키를 기반으로 하고 있지만, 쿠키와는 달리 세션 정보는 서버에서 관리한다.
사용자가 서버에 요청 시 새로운 세션을 생성하고 해상 세션에 통신에 사용할 데이터를 저장한 뒤, 세션 ID를 쿠키에 담아서 전송하는 방식으로 **서버 측에서** 데이터를 관리한다.

## 세션의 동작 방식

1. 클라이언트가 서버에 요청 시 서버는 세션을 만들고 세션 ID를 부여한다.
2. 서버는 세션 ID를 쿠키에 담아서 사용자에게 전송한다.
3. 클라이언트는 쿠키에 세션 ID를 저장하고 있다가, 다른 요청 쿠키에 세션 ID를 함께 전송한다.
4. 서버는 해당 쿠키를 읽어 세션 ID를 통해 사용자를 식별하고 세션에 있는 정보를 이용한다.
5. 세션의 정보를 기반으로 사용자의 요청에 대한 처리를 한다.

### 세션의 특징

세션과 쿠키의 가장 큰 차이점은 데이터의 저장 장소다.

쿠키는 서버에서 생성될 지라도 결국은 브라우저의 로컬에 저장되게 되고,
세션은 서버에서 생성하여 서버에 저장하고, 브라우저는 세션을 식별할 세션 ID만 브라우저의 쿠키에 저장한다.

세션은 서버에 데이터를 저장하기 때문에 쿠키에 비해 보안적으로 우수하다.
하지만 세션은 서버에 데이터를 저장하기 떄문에 모든 데이터를 세션에 저장하기에는 서버의 메모리의 한계가 있기 때문에 주로 보안적으로 중요한 데이터를 세션에 저장해서 사용한다.

또한 세션쿠키는 브라우저가 종료되면 삭제되어 더 이상 사용할 수 없다.

---

# 쿠키와 세션의 차이점

## 차이점

- 데이터의 저장 장소 (클라이언트 vs 서버)
- 보안 측면에서는 세션이 쿠키보다 유리
- 속도 측면에서는 쿠키가 세션보다 유리
- 쿠키는 브라우저가 종료되더라도 만료기간 전에는 데이터를 유지하지만, 세션은 브라우저가 종료되면 삭제된다.


# 쿠키와 로컬스토리지의 차이
쿠키와 세션을 정리하다 보니 쿠키랑 로컬스토리지의 차이가 헷갈려서 구글링해봤다.

가장 큰 차이는 일단 쿠키는 서버로 전송되고 로컬스토리지는 전송되지 않는다는 점.

목적성에서의 차이는 쿠키는 가볍고 일시적인 데이터를 처리할 때 사용하는 편인것 같고
로컬스토리지는 자동 로그인이나 다크모드 설정값 같은 지속적인 데이터를 저장할 떄 사용하는 것 같다.


---

# 여담
쿠키와 세션은 이해하고 있어도 가끔 헷갈릴 때가 있는것 같다. 이전에 블로그 서비스를 구현해볼 떄 로그인 정보 유지를 위해서 express에서 세션을 사용한 적이 있는데 결과적으로는 목적에 맞게 사용했지만 그때는 쿠키와 세션에 대해 정확히 이해하지 못하고 그냥 작성했던 것 같다. 

이젠 쿠키와 세션이 어떨 때에 필요하고 어떻게 구성되는지 알았으니 다음에는 더 잘 적용할 수 있을것 같은 기분

